import{K as Z,M as q,N as ee,b as N,h as te,o as ne,s as U,ad as se,ae as M,af as x,ag as ae,k as ie,a as I,P as S,ah as oe,ai as ce,aj as re,G as le,ak as de,al as ue,e as pe}from"./index.9ce0a29e.js";import{k as V,r as C,H as L,q as a,F as m,G as b,C as n,K as $,u,v as l,J as s,I as h,j as w,L as F,_ as _e,A as ye,B as me,a1 as d}from"./@vuelidate.e7200945.js";import"./google-spreadsheet.016741c3.js";import"./maci.f28b6353.js";import"./@kleros/gtcr-encoder.75dc8b9f.js";const he={class:"modal-body"},ve=V({__name:"TransactionModal",props:{transaction:null,onTxSuccess:{type:Function}},emits:["close"],setup(p,{emit:v}){const _=p,y=C(""),g=C("");L(()=>{f()});async function f(){try{await Z(_.transaction,c=>y.value=c),_.onTxSuccess(y.value)}catch(c){g.value=c.message;return}}return(c,o)=>(a(),m(u(ee),{class:"modal-container"},{default:b(()=>[n("div",he,[$(q,{hash:u(y),error:u(g),displayRetryBtn:!0,onClose:o[0]||(o[0]=R=>v("close")),onRetry:o[1]||(o[1]=()=>{g.value="",f()})},null,8,["hash","error"]),u(y)?(a(),l("button",{key:0,class:"btn-secondary close-btn",onClick:o[2]||(o[2]=R=>v("close"))},s(c.$t("transactionModal.button1")),1)):h("",!0)])]),_:1}))}});const ge=N(ve,[["__scopeId","data-v-6d50d597"]]),T=p=>(ye("data-v-7394b58b"),p=p(),me(),p),be={class:"recipients"},fe={class:"title"},Re={class:"header"},ke=T(()=>n("div",{class:"hr"},null,-1)),Ie={key:1},we={class:"requests"},$e={class:"project-name"},Ce=["src"],xe={class:"project-details"},Se={class:"btn-row"},Te={class:"btn-row"},je={class:"btn-row"},Ae={key:0,class:"actions"},Be=["onClick"],Ee=T(()=>n("img",{src:ue},null,-1)),Pe=[Ee],Ue=["onClick"],Me=T(()=>n("img",{src:pe},null,-1)),Fe=[Me],Ne=V({__name:"RecipientRegistry",setup(p){const v=te(),_=ne(),{currentUser:y}=U(_),{isRecipientRegistryOwner:g,recipientRegistryInfo:f,recipientRegistryAddress:c}=U(v),o=C([]),R=C(!0),j=w(()=>g.value),H=w(()=>!!y.value),G=w(()=>o.value.filter(i=>k(i)).length>0);L(async()=>{await v.loadRecipientRegistryInfo(),await A(),R.value=!1});async function A(){const t=await se(f.value,c.value);o.value=t.filter(i=>Boolean(i.requester))}function k(t){return t.status===x.Submitted}function B(t){return t.status===x.Accepted}function E(t){return t.type===oe.Registration&&t.status===x.Executed}async function O(t){await P(ce(c.value,t.recipientId,_.signer))}async function D(t){await P(re(c.value,t.recipientId,t.requester,_.signer))}async function P(t){const{open:i,close:e}=le({component:ge,attrs:{onTxSuccess:async()=>{try{await new Promise(r=>{setTimeout(async()=>{await A(),r(!0)},2e3)})}catch(r){de(r.message)}},transaction:t,onClose(){e()}}});i()}function J(){const t=o.value.filter(e=>k(e));let i=1;for(let e=0;e<t.length;e=e+M){const r=e+M,W=t.slice(e,r),X=z(W),Y=`pending-submission-${i}.json`;Q(X,Y),i++}}const K=w(()=>({inputs:[{internalType:"bytes32",name:"_recipientId",type:"bytes32"},{internalType:"address payable",name:"_beneficiary",type:"address"}],name:"challengeRequest",payable:!1}));function z(t){const i=t.map(r=>({to:c.value,value:"0",data:null,contractMethod:K.value,contractInputsValues:{_recipientId:r.recipientId,_beneficiary:r.requester}})),e={version:"1.0",chainId:ae,createdAt:Date.now(),meta:{name:"Pending Submissions",txBuilderVersion:"1.11.1"},transactions:i};return"data:application/json,"+encodeURIComponent(JSON.stringify(e))}function Q(t,i){const e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("download",i),document.body.appendChild(e),e.click(),document.body.removeChild(e)}return(t,i)=>(a(),l("div",be,[n("div",fe,[n("div",Re,[n("h2",null,s(t.$t("recipientRegistry.h2")),1)]),ke]),R.value?(a(),m(ie,{key:0})):(a(),l("div",Ie,[u(G)?(a(),l("button",{key:0,class:"btn-secondary desktop btn-export",onClick:J}," Export pending submissions ")):h("",!0),n("table",we,[n("thead",null,[n("tr",null,[n("th",null,s(t.$t("recipientRegistry.th1")),1),n("th",null,s(t.$t("recipientRegistry.th2")),1),n("th",null,s(t.$t("recipientRegistry.th3")),1),n("th",null,s(t.$t("recipientRegistry.th4")),1)])]),n("tbody",null,[(a(!0),l(F,null,_e(o.value.slice().reverse(),e=>(a(),l("tr",{key:e.recipientId},[n("td",null,[n("div",$e,[e.metadata.thumbnailImageUrl?(a(),m(I,{key:0,to:e.metadata.thumbnailImageUrl},{default:b(()=>[n("img",{class:"project-image",src:e.metadata.thumbnailImageUrl},null,8,Ce)]),_:2},1032,["to"])):h("",!0),d(" "+s(e.metadata.name)+" ",1),E(e)?(a(),m(I,{key:1,to:{name:"project",params:{id:e.recipientId}}},{default:b(()=>[d("->")]),_:2},1032,["to"])):(a(),m(I,{key:2,to:{name:"recipient-profile",params:{id:e.recipientId}}},{default:b(()=>[d("->")]),_:2},1032,["to"]))]),n("details",xe,[n("summary",null,s(t.$t("recipientRegistry.summary")),1),n("div",null,[n("div",Se,[d(s(t.$t("recipientRegistry.div1"))+" ",1),$(S,{value:e.transactionHash,text:t.$t("recipientRegistry.btn1"),myClass:"inline copy-icon"},null,8,["value","text"])]),n("code",null,s(e.transactionHash),1)]),n("div",null,[n("div",Te,[d(s(t.$t("recipientRegistry.div2"))+" ",1),$(S,{value:e.recipientId,text:t.$t("recipientRegistry.btn2"),myClass:`inline
                    copy-icon`},null,8,["value","text"])]),n("code",null,s(e.recipientId),1)]),n("div",null,[n("div",je,[d(s(t.$t("recipientRegistry.div3"))+" ",1),$(S,{value:e.recipient,text:t.$t("recipientRegistry.btn3"),myClass:"copy-icon"},null,8,["value","text"])]),n("code",null,s(e.recipient),1)])])]),n("td",null,s(e.type),1),n("td",null,[E(e)?(a(),m(I,{key:0,to:{name:"project",params:{id:e.recipientId}}},{default:b(()=>[d(s(e.status),1)]),_:2},1032,["to"])):(a(),l(F,{key:1},[d(s(e.status),1)],64))]),n("td",null,[u(H)?(a(),l("div",Ae,[u(j)&&k(e)||B(e)?(a(),l("div",{key:0,class:"icon-btn-approve",onClick:r=>O(e)},Pe,8,Be)):h("",!0),u(j)&&(k(e)||B(e))?(a(),l("div",{key:1,class:"icon-btn-reject",onClick:r=>D(e)},Fe,8,Ue)):h("",!0)])):h("",!0)])]))),128))])])]))]))}});const De=N(Ne,[["__scopeId","data-v-7394b58b"]]);export{De as default};
